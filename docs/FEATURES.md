# ThinkBlock 기능 명세서

## 목차
1. [프로젝트 관리](#프로젝트-관리)
2. [블록 관리](#블록-관리)
3. [시각화](#시각화)
4. [카테고리 관리](#카테고리-관리)
5. [AI 기능](#ai-기능)
6. [사용자 인터페이스](#사용자-인터페이스)

---

## 프로젝트 관리

### 프로젝트 생성
**설명**: 새로운 프로젝트를 생성하여 작업을 시작합니다.

**사용 방법**:
1. 프로젝트 목록 페이지에서 "새 프로젝트" 버튼 클릭
2. 프로젝트 이름 입력
3. 생성 완료

**기술적 세부사항**:
- Firestore에 새 프로젝트 문서 생성
- 고유한 프로젝트 ID 자동 생성 (UUID)
- 생성 시간 및 수정 시간 자동 기록

**API 엔드포인트**: `POST /api/projects`

---

### 프로젝트 수정
**설명**: 프로젝트 이름을 변경합니다.

**사용 방법**:
1. 헤더의 프로젝트 이름 클릭
2. 이름 수정
3. 엔터 키 또는 저장 버튼 클릭

**기술적 세부사항**:
- 실시간 업데이트
- 수정 시간 자동 갱신

**API 엔드포인트**: `PUT /api/projects/{project_id}`

---

### 프로젝트 삭제
**설명**: 프로젝트와 모든 관련 데이터를 삭제합니다.

**사용 방법**:
1. 프로젝트 목록 페이지에서 삭제 버튼 클릭
2. 확인 모달에서 확인

**기술적 세부사항**:
- 프로젝트 문서 및 모든 하위 컬렉션(blocks, metadata) 삭제
- 되돌릴 수 없음

**API 엔드포인트**: `DELETE /api/projects/{project_id}`

---

### 프로젝트 복제
**설명**: 기존 프로젝트를 복제하여 새 프로젝트를 만듭니다.

**사용 방법**:
1. 프로젝트 목록에서 복제 아이콘 클릭
2. 새 프로젝트 이름 입력
3. 복제 옵션 선택:
   - **블록만 복사**: 블록을 미배치 상태(레벨 -1)로 복사
   - **전체 복사**: 계층 구조를 그대로 유지하여 복사
4. 확인

**기술적 세부사항**:
- 카테고리는 항상 복사됨
- 새 프로젝트 ID 생성
- 블록 ID는 새로 생성됨

**API 엔드포인트**: `POST /api/projects/{project_id}/duplicate`

---

## 블록 관리

### 블록 생성
**설명**: 새로운 블록을 추가합니다.

**사용 방법**:
1. 왼쪽 입력 영역에서 "+" 버튼 클릭
2. 블록 제목 입력
3. 엔터 키 또는 다른 영역 클릭

**기술적 세부사항**:
- 기본 레벨: -1 (미배치)
- 기본 순서: 0
- 즉시 Firestore에 저장

**API 엔드포인트**: `POST /api/projects/{project_id}/blocks`

---

### 블록 편집
**설명**: 블록의 제목, 설명, 카테고리를 수정합니다.

**사용 방법**:
1. 블록을 더블클릭
2. 모달에서 정보 수정
3. "수정" 버튼 클릭

**편집 가능한 필드**:
- 제목 (필수)
- 설명 (선택)
- 카테고리 (선택)

**기술적 세부사항**:
- 모달을 통한 편집
- 실시간 업데이트

**API 엔드포인트**: `PUT /api/projects/{project_id}/blocks/{block_id}`

---

### 블록 삭제
**설명**: 개별 블록을 삭제합니다.

**사용 방법**:
1. 블록에 마우스 오버
2. 우측 상단 휴지통 아이콘 클릭
3. 확인

**기술적 세부사항**:
- Firestore에서 즉시 삭제
- 되돌릴 수 없음

**API 엔드포인트**: `DELETE /api/projects/{project_id}/blocks/{block_id}`

---

### 블록 계층화 (드래그 앤 드롭)
**설명**: 블록을 드래그하여 피라미드의 원하는 레벨에 배치합니다.

**사용 방법**:
1. 블록을 클릭하고 드래그
2. 원하는 레벨의 드롭 영역에 드롭
3. 자동으로 레벨 및 순서 업데이트

**레벨 설명**:
- **레벨 0 (기반)**: 가장 먼저 구축해야 할 기반 인프라
- **레벨 1-4**: 단계별 핵심 기능 및 고급 기능
- **레벨 5 (목표)**: 최종 목표
- **레벨 -1**: 미배치 (왼쪽 목록에 표시)

**기술적 세부사항**:
- @dnd-kit 라이브러리 사용
- 같은 레벨 내 순서 변경 가능
- 다른 레벨로 이동 시 자동 순서 조정

---

### 블록 순서 변경
**설명**: 같은 레벨 내에서 블록의 순서를 변경합니다.

**사용 방법**:
1. 같은 레벨의 블록을 드래그
2. 원하는 위치에 드롭

**기술적 세부사항**:
- order 필드 자동 업데이트
- 다른 블록들의 순서도 자동 조정

---

### 전체 블록 초기화
**설명**: 프로젝트의 모든 블록을 한 번에 삭제합니다.

**사용 방법**:
1. 헤더의 "초기화" 버튼 클릭
2. 확인 모달에서 "삭제" 클릭

**기술적 세부사항**:
- 모든 블록 일괄 삭제
- AI 배치 이유도 함께 초기화
- 되돌릴 수 없음

---

## 시각화

### 피라미드 뷰
**설명**: 블록을 피라미드 형태로 계층 구조를 시각화합니다.

**특징**:
- 레벨별 색상 구분
- 레벨 태그 표시 (기반, Level 1-4, 목표)
- 드래그 앤 드롭 지원
- 빈 레벨에는 드롭 영역 표시

**레이아웃**:
- 왼쪽: 블록 입력 및 미배치 블록 목록
- 오른쪽: 피라미드 뷰

---

### 테이블 뷰
**설명**: 블록을 표 형식으로 확인 및 관리합니다.

**컬럼**:
- 레벨
- 제목
- 카테고리
- 설명
- 작업 (삭제)

**기능**:
- 레벨별 정렬 (낮은 레벨부터)
- 블록 더블클릭으로 편집
- 삭제 버튼으로 개별 삭제

---

## 카테고리 관리

### 카테고리 추가
**설명**: 새로운 카테고리를 추가합니다.

**사용 방법**:
1. 헤더의 "카테고리 관리" 버튼 클릭
2. 입력 필드에 카테고리 이름 입력
3. "추가" 버튼 클릭

**기술적 세부사항**:
- Firestore의 `metadata/categories` 문서에 저장
- 즉시 모든 블록에서 사용 가능

**API 엔드포인트**: `PUT /api/projects/{project_id}/categories`

---

### 카테고리 수정
**설명**: 기존 카테고리 이름을 변경합니다.

**사용 방법**:
1. 카테고리 관리 모달에서 카테고리 이름 클릭
2. 수정
3. 엔터 키 또는 다른 영역 클릭

**기술적 세부사항**:
- 해당 카테고리를 사용하는 모든 블록에 자동 반영

---

### 카테고리 삭제
**설명**: 카테고리를 삭제합니다.

**사용 방법**:
1. 카테고리 관리 모달에서 삭제 버튼 클릭
2. 확인

**기술적 세부사항**:
- 해당 카테고리를 사용하는 블록의 카테고리는 빈 값으로 변경

---

### 블록에 카테고리 할당
**설명**: 블록에 카테고리를 할당합니다.

**사용 방법**:
1. 블록 편집 모달에서 카테고리 드롭다운 클릭
2. 카테고리 선택 또는 새로 생성

**UI 특징**:
- Notion 스타일 드롭다운
- 블록 상단에 카테고리 태그로 표시

---

## AI 기능

### AI 블록 생성
**설명**: 프로젝트 정보를 입력하면 AI가 자동으로 블록을 생성합니다.

**사용 방법**:
1. AI 버튼 클릭 → "블록 생성" 선택
2. 모달에서 다음 정보 입력:
   - **프로젝트 개요**: 프로젝트의 전체적인 목적과 범위
   - **현재 진행 상황**: 현재까지 완료된 작업
   - **문제점/병목지점**: 현재 직면한 문제나 병목
   - **기타 참고 사항**: 추가로 고려할 사항
3. "생성" 버튼 클릭
4. 생성 완료 후 블록 확인

**생성되는 블록**:
- 최소 5개 이상의 블록 생성
- 각 블록에 제목, 설명, 카테고리 자동 할당
- 기본 레벨: -1 (미배치)

**AI 모델**: Google Vertex AI Gemini 2.5 Flash

**기술적 세부사항**:
- 프롬프트 엔지니어링을 통한 구조화된 출력
- JSON 형식으로 응답 받아 파싱
- 카테고리 자동 생성/추가 가능
- 실패 시 재시도 버튼 제공

**API 엔드포인트**: `POST /api/projects/{project_id}/ai/generate-blocks`

---

### AI 블록 배치
**설명**: 선택한 블록들을 AI가 체계적인 사고 과정을 거쳐 적절한 레벨에 자동 배치합니다.

**사용 방법**:
1. AI 버튼 클릭 → "블록 배치" 선택
2. 배치할 블록들을 체크박스로 선택
3. "배치" 버튼 클릭
4. 배치 완료 후 피라미드 뷰 확인
5. 왼쪽 하단의 메모장 버튼으로 배치 이유 확인

**체계적인 사고 과정 (thinking_process)**:
1. **프로젝트 분석**: 저장된 project_analysis를 활용하여 프로젝트 맥락 파악
2. **레벨 5 (목표) 분석**: 최종 목표로 설정할 블록 식별
3. **레벨별 목표 설정**: 각 레벨(0-5)의 목표와 가치 정의
4. **의존성 및 우선순위 분석**: 블록 간 관계 및 우선순위 분석
5. **서비스 설계자 관점의 조언**: 놓친 부분, 리스크, 개선점 제안
6. **최종 배치 결정**: 위 분석을 바탕으로 각 블록을 적절한 레벨에 배치

**배치 기준**:
- **의존성 관계**: 블록 A가 블록 B에 의존 → A는 낮은 레벨
- **우선순위**: 긴급하고 중요한 작업은 낮은 레벨
- **기반 인프라 우선**: 인프라, 데이터베이스는 낮은 레벨
- **논리적 순서**: 논리적으로 먼저 완료되어야 하는 작업은 낮은 레벨
- **위험도**: 높은 위험을 가진 작업은 낮은 레벨 (조기 검증)

**레벨 분산**:
- 모든 블록을 레벨 0에 배치하지 않음
- 0-5 레벨에 골고루 분산 배치

**AI 모델**: Google Vertex AI Gemini 2.0 Flash Exp

**기술적 세부사항**:
- 저장된 프로젝트 분석(project_analysis)을 활용하여 더 정확한 배치 수행
- 체계적인 사고 과정을 거친 상세한 배치 이유(reasoning) 생성
- 배치 이유가 프로젝트에 저장되어 페이지 새로고침 후에도 확인 가능
- 각 블록의 배치 이유(reason) 포함
- 실패 시 재시도 버튼 제공

**API 엔드포인트**: `POST /api/projects/{project_id}/ai/arrange-blocks`

---

### AI 배치 이유 확인
**설명**: AI가 블록을 배치한 체계적인 사고 과정과 이유를 확인합니다.

**사용 방법**:
1. AI 블록 배치 완료 후
2. 왼쪽 하단의 메모장 아이콘 플로팅 버튼 클릭
3. 모달에서 배치 이유 확인

**표시되는 정보**:
- **레벨 5 (목표) 분석**: 최종 목표로 설정한 블록과 그 이유
- **레벨별 목표**: 각 레벨(0-5)에서 달성해야 할 목표
- **의존성 및 우선순위 분석**: 블록 간 관계 및 우선순위
- **서비스 설계자 관점의 조언**: 놓친 부분, 리스크, 개선점
- **최종 배치 결정**: 배치 결정의 근거
- **블록별 배치 이유**: 각 블록이 특정 레벨에 배치된 상세 이유

**기술적 세부사항**:
- 배치 완료 시에만 버튼 활성화
- 배치 이유가 프로젝트에 저장되어 페이지 새로고침 후에도 확인 가능
- 모달로 상세 내용 표시

---

## 사용자 인터페이스

### 헤더
**구성 요소**:
- 프로젝트 이름 (편집 가능)
- 프로젝트 목록 버튼
- 카테고리 관리 버튼
- 초기화 버튼 (빨간색)

### 탭 네비게이션
- **탭 0**: 피라미드 뷰
- **탭 1**: 테이블 뷰

### 블록 입력 영역
- "+" 버튼: 블록 추가
- AI 버튼: AI 기능 메뉴
- 미배치 블록 목록 표시

### 모달
- 블록 편집 모달
- 카테고리 관리 모달
- AI 블록 생성 모달
- AI 블록 배치 모달
- AI 배치 이유 모달
- 초기화 확인 모달

### 플로팅 버튼
- 왼쪽 하단 메모장 아이콘
- AI 배치 이유 확인용
- 배치 완료 시에만 활성화

---

## 키보드 단축키

- **Enter**: 블록 추가/수정 완료
- **Escape**: 모달 닫기 (일부 모달)

---

## 제한사항 및 향후 개선

### 현재 제한사항
- 단일 사용자 환경 (실시간 협업 없음)
- 파일 첨부 불가
- 히스토리 관리 없음
- 블록 간 연결선 표시 없음

### 향후 개선 계획
- 블록 간 의존성 시각화 (연결선)
- 블록에 추가 정보 필드 (우선순위, 예상 시간, 담당자)
- 실시간 협업 기능
- 블록 내보내기/가져오기 (JSON, CSV)
- 히스토리 관리 및 되돌리기

